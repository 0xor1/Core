/*! CORE v0.0.1 2013-05-02 */
(function(e){(function(e){var t=window[e]=window[e]||{};t.Dom=function(e){t.Eventable.call(this),this.dom=t.Dom.domGenerator(e)},t.Dom.prototype=Object.create(t.Eventable.prototype),t.Dom.prototype.addChild=function(){throw Error("Dom object does not implement addChild method")},t.Dom.prototype.removeChild=function(){throw Error("Dom object does not implement removeChild method")},t.Dom.prototype.removeSelf=function(){this.parent&&this.parentNode.removeChild(this.dom)},t.Dom.prototype.dispose=function(){this.removeSelf(),t.Eventable.prototype.dispose.call(this)},t.Dom.domGenerator=function(e){if(!e)return null;var n=document.createElement(e.tag);if(t.Dom.style(n,e.style),e.class&&(n.className=e.class),e.id&&(n.id=e.id),e.children&&e.children.length>0)for(var o=0,i=e.children.length;i>o;o++)n.appendChild(t.Dom.domGenerator(e.children[o]));return n},t.Dom.style=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e.style[n]=t[n])}})(e),function(e){function t(e){a.push(e[h.fnId]),delete e[h.fnId]}function n(){return a.length>0?a.pop():d++}function o(){return s.length>0?s.pop():r++}var i=window[e]=window[e]||{},r=0,s=[],d=0,a=[],h={};h._="_",h.prfx=h._+e+h._,h.fnId=h.prfx+"id",h.fnUsageCount=h.prfx+"usageCount",i.Eventable=function(){this._id=o()},i.Eventable.prototype={id:function(){return this._id},on:function(e,t,n){var o=e._eventContractQueues=e._eventContractQueues||{},i=o[t]=o[t]||[],r=this._eventContracts=this._eventContracts||{},s=new f(this,e,t,n);return r[s.key]===void 0&&(i.push(s),"number"==typeof n[h.fnUsageCount]?n[h.fnUsageCount]++:n[h.fnUsageCount]=1,r[s.key]=s,i.isDispatching&&i.numListenersAdded++),this},off:function(e,n,o){if(!this._eventContracts)return this;var i,r,s=this._eventContracts[f.generateKey(e,n,o)];return s?(i=e._eventContractQueues[n],r=i.indexOf(s),i.isDispatching&&(i.updated=!0,i.removedIndexes.push(r)),i.splice(r,1),o[h.fnUsageCount]--,0===o[h.fnUsageCount]&&t(o),delete this._eventContracts[s.key],this):this},fire:function(e){if(void 0!==this._eventContractQueues){var t=this._eventContractQueues[e.type];if(t!==void 0){if(t.isDispatching)return;t.isDispatching=!0,t.dispatchQueueUpdated=!1,t.removedIndexes=[],t.numListenersAdded=0,e.obj=this;for(var n=0,o=t.length;o>n;n++){if(t.dispatchQueueUpdated){o=t.length-t.numListenersAdded;for(var i=n,r=0,s=t.removedIndexes.length;s>r;r++)i>t.removedIndexes[r]&&n--;t.removedIndexes=[],t.dispatchQueueUpdated=!1}t[n].fulfill(e)}t.isDispatching=!1}return this}},dispose:function(){var e=this._eventContracts;if(e)for(var t in e)e.hasOwnProperty(t)&&e[t].finalise();var n=this._eventContractQueues;if(n)for(var o in n)if(n.hasOwnProperty(o))for(var i=n[o],r=i.length,d=0;r>d;d++)i[d].finalise();s.push(this._id);for(o in this)this.hasOwnProperty(o)&&delete this[o]}};var f=function(){function e(t,n,o,i){this.owner=t,this.obj=n,this.type=o,this.fn=i,this.key=e.generateKey(n,o,i)}return e.prototype.fulfill=function(e){this.fn.call(this.owner,e)},e.prototype.finalise=function(){this.owner.off(this.obj,this.type,this.fn)},e.generateKey=function(e,t,o){var i=o[h.fnId]=o[h.fnId]===void 0?n():o[h.fnId];return h._+e._id+h._+t+h._+i},e}()}(e)})("CORE");