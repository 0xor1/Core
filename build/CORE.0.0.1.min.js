/*! CORE 2013-05-01 */
(function(){var e="CORE",t={},n=t.rs={};n._="_",n.prfx=n._+e+n._,n.fnId=n.prfx+"id",n.fnUsageCount=n.prfx+"usageCount",window[e]={Eventable:t.Eventable,Dom:t.Dom}})(),function(e){e.Dom=function(t){e.Eventable.call(this),this.dom=e.Dom.domGenerator(t)},e.Dom.prototype=Object.create(e.Eventable.prototype),e.Dom.prototype.addChild=function(){throw Error("Dom object does not implement addChild method")},e.Dom.prototype.removeChild=function(){throw Error("Dom object does not implement removeChild method")},e.Dom.prototype.removeSelf=function(){this.parent&&this.parentNode.removeChild(this.dom)},e.Dom.prototype.dispose=function(){this.removeSelf(),e.Eventable.prototype.dispose.call(this)},e.Dom.domGenerator=function(t){if(!t)return null;var n=document.createElement(t.tag);if(e.Dom.style(n,t.style),t.class&&(n.className=t.class),t.id&&(n.id=t.id),t.children&&t.children.length>0)for(var o=0,i=t.children.length;i>o;o++)n.appendChild(e.Dom.domGenerator(t.children[o]));return n},e.Dom.style=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e.style[n]=t[n])}}(ns),function(e){function t(e){d.push(e[i.fnId]),delete e[i.fnId]}function n(){return d.length>0?d.pop():a++}function o(){return s.length>0?s.pop():r++}var i=e.rs,r=0,s=[],a=0,d=[];e.Eventable=function(){this._id=o()},e.Eventable.prototype={id:function(){return this._id},on:function(e,t,n){var o=e._eventContractQueues=e._eventContractQueues||{},r=o[t]=o[t]||[],s=this._eventContracts=this._eventContracts||{},a=new h(this,e,t,n);return s[a.key]===void 0&&(r.push(a),"number"==typeof n[i.fnUsageCount]?n[i.fnUsageCount]++:n[i.fnUsageCount]=1,s[a.key]=a,r.isDispatching&&r.numListenersAdded++),this},off:function(e,n,o){if(!this._eventContracts)return this;var r,s,a=this._eventContracts[h.generateKey(e,n,o)];return a?(r=e._eventContractQueues[n],s=r.indexOf(a),r.isDispatching&&(r.updated=!0,r.removedIndexes.push(s)),r.splice(s,1),o[i.fnUsageCount]--,0===o[i.fnUsageCount]&&t(o),delete this._eventContracts[a.key],this):this},fire:function(e){if(void 0!==this._eventContractQueues){var t=this._eventContractQueues[e.type];if(t!==void 0){if(t.isDispatching)return;t.isDispatching=!0,t.dispatchQueueUpdated=!1,t.removedIndexes=[],t.numListenersAdded=0,e.obj=this;for(var n=0,o=t.length;o>n;n++){if(t.dispatchQueueUpdated){o=t.length-t.numListenersAdded;for(var i=n,r=0,s=t.removedIndexes.length;s>r;r++)i>t.removedIndexes[r]&&n--;t.removedIndexes=[],t.dispatchQueueUpdated=!1}t[n].fulfill(e)}t.isDispatching=!1}return this}},dispose:function(){var e=this._eventContracts;if(e)for(var t in e)e.hasOwnProperty(t)&&e[t].finalise();var n=this._eventContractQueues;if(n)for(var o in n)if(n.hasOwnProperty(o))for(var i=n[o],r=i.length,a=0;r>a;a++)i[a].finalise();s.push(this._id);for(o in this)this.hasOwnProperty(o)&&delete this[o]}};var h=function(){function e(t,n,o,i){this.owner=t,this.obj=n,this.type=o,this.fn=i,this.key=e.generateKey(n,o,i)}return e.prototype.fulfill=function(e){this.fn.call(this.owner,e)},e.prototype.finalise=function(){this.owner.off(this.obj,this.type,this.fn)},e.generateKey=function(e,t,o){var r=o[i.fnId]=o[i.fnId]===void 0?n():o[i.fnId];return i._+e._id+i._+t+i._+r},e}()}(ns);